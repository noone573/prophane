{% load static %}
<!DOCTYPE html>
<html>
<head>
  <title>Propane Point - Find Gas Near You</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
    :root {
      --primary-orange: #FF8C42;
      --primary-cyan: #00B4D8;
      --dark-blue: #023E8A;
      --light-bg: #F8F9FA;
    }
    
    html, body {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    /* Navbar */
    .navbar {
      width: 100%;
      height: 85px;
      background: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 40px;
      box-sizing: border-box;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      position: relative;
      z-index: 1000;
      border-bottom: 4px solid var(--primary-orange);
    }
    
    .logo-container {
      display: flex;
      align-items: center;
      gap: 0;
      position: relative;
      text-decoration: none;
    }
    
    .logo-icon {
      width: 120px;
      height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      z-index: 2;
    }
    
    .logo-img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      filter: drop-shadow(0 4px 10px rgba(0,0,0,0.15));
    }

    .logo-text {
      display: flex;
      flex-direction: column;
      line-height: 1;
      margin-left: -15px;
    }
    
    .logo-text-top {
      font-size: 22px;
      color: var(--primary-cyan);
      font-weight: 600;
      font-style: italic;
      margin-bottom: 2px;
    }
    
    .logo-text-bottom {
      font-size: 32px;
      color: var(--dark-blue);
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: 2px;
    }
    
    .nav-buttons {
      display: flex;
      gap: 25px;
      align-items: center;
    }
    
    .nav-btn {
      background: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
      text-decoration: none;
      position: relative;
      padding: 10px 18px;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 700;
      color: var(--dark-blue);
      border: 2px solid transparent;
    }
    
    .nav-btn:hover {
      background: linear-gradient(135deg, var(--primary-orange) 0%, #FFB366 100%);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(255,140,66,0.4);
    }
    
    .nav-btn.apply-seller {
      background: linear-gradient(135deg, #28A745 0%, #20C997 100%);
      color: white;
      border: 2px solid #28A745;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .nav-btn.apply-seller:hover {
      background: linear-gradient(135deg, #218838 0%, #1EA87A 100%);
      border-color: #218838;
    }
    
    .nav-btn.logout {
      background: #DC3545;
      color: white;
      border: 2px solid #DC3545;
    }
    
    .nav-btn.logout:hover {
      background: #C82333;
      border-color: #C82333;
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(220,53,69,0.4);
    }
    
    .notification-badge {
      position: absolute;
      top: 3px;
      right: 8px;
      background: #DC3545;
      color: white;
      border-radius: 50%;
      min-width: 20px;
      height: 20px;
      font-size: 11px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      border: 2px solid white;
      padding: 0 5px;
    }
    
    /* Role Badge */
    .role-badge {
      padding: 6px 15px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-left: 10px;
    }
    
    .role-customer {
      background: linear-gradient(135deg, #E0F7FA 0%, #B2EBF2 100%);
      color: var(--primary-cyan);
      border: 2px solid var(--primary-cyan);
    }
    
    .role-seller {
      background: linear-gradient(135deg, #D4EDDA 0%, #C3E6CB 100%);
      color: #28A745;
      border: 2px solid #28A745;
    }
    
    .role-admin {
      background: linear-gradient(135deg, #F8D7DA 0%, #F5C6CB 100%);
      color: #DC3545;
      border: 2px solid #DC3545;
    }
    
    #map {
      height: calc(100vh - 85px);
      width: 100vw;
    }
    
    /* Custom marker icon styling */
    .custom-marker {
      background: var(--primary-orange);
      width: 35px;
      height: 35px;
      border-radius: 50% 50% 50% 0;
      transform: rotate(-45deg);
      border: 3px solid white;
      box-shadow: 0 3px 10px rgba(0,0,0,0.3);
    }
    
    /* Modal base */
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(2, 62, 138, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      animation: fadeIn 0.3s;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 20px;
      width: 850px;
      max-height: 85vh;
      box-shadow: 0 15px 50px rgba(0,0,0,0.4);
      animation: slideUp 0.4s ease-out;
      border: 4px solid var(--primary-cyan);
    }
    
    @keyframes slideUp {
      from { transform: translateY(50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    /* Store modal - UNIFIED CARD LAYOUT */
    .store-content-wrapper {
      background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%);
      border-radius: 15px;
      padding: 25px;
      display: flex;
      gap: 25px;
      min-height: 500px;
    }
    
    .store-sidebar {
      width: 200px;
      background: white;
      border-radius: 12px;
      padding: 20px 15px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .owner-photo {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      border: 5px solid white;
      margin-bottom: 20px;
      object-fit: cover;
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
      background: white;
    }
    .store-sidebar h4 {
      font-size: 18px;
      font-weight: 800;
      margin: 8px 0;
      color: var(--dark-blue);
      word-wrap: break-word;
    }
    
    .store-owner-name {
      font-size: 12px;
      color: #666;
      margin-bottom: 12px;
      font-style: italic;
    }
    
    .description {
      margin-top: 12px;
      font-size: 12px;
      text-align: center;
      line-height: 1.5;
      color: #555;
      background: #f8f9fa;
      padding: 10px;
      border-radius: 8px;
    }
    
    /* Store modal main area */
    .store-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      max-height: 500px;
    }
    
    .store-main h3 {
      margin-top: 0;
      font-size: 22px;
      color: var(--dark-blue);
      margin-bottom: 20px;
      font-weight: 800;
    }
    
    /* Tank grid */
    .tank-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 15px;
      flex: 1;
    }
    
    .tank-card-new {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      padding: 15px;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      transition: all 0.3s;
      cursor: pointer;
      position: relative;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .tank-card-new:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,180,216,0.3);
      border-color: var(--primary-cyan);
    }
    
    .tank-card-new.out-of-stock {
      opacity: 0.5;
      cursor: not-allowed;
      filter: grayscale(1);
    }
    
    .tank-card-new.out-of-stock:hover {
      transform: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      border-color: #e0e0e0;
    }
    
    .tank-image-new {
      width: 70px;
      height: 70px;
      object-fit: contain;
      margin-bottom: 10px;
      background: transparent;
      padding: 5px;
    }
    
    .tank-card-new strong {
      font-size: 14px;
      color: var(--dark-blue);
      font-weight: 700;
      margin-bottom: 6px;
      display: block;
    }
    
    .tank-price-new {
      font-size: 20px;
      color: var(--primary-orange);
      font-weight: 900;
      margin: 6px 0 10px 0;
    }
    
    .tank-stock-info {
      font-size: 11px;
      margin-bottom: 12px;
      width: 100%;
    }
    
    .stock-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 10px;
      font-size: 10px;
      font-weight: 700;
    }
    
    .stock-low {
      background: #FFE0E0;
      color: #C00;
    }
    
    .stock-medium {
      background: #FFF3CD;
      color: #856404;
    }
    
    .stock-high {
      background: #D4EDDA;
      color: #155724;
    }
    
    .stock-out {
      background: #F8D7DA;
      color: #721C24;
    }
    
    /* Quantity controls */
    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: auto;
      padding-top: 8px;
    }
    
    .qty-btn {
      width: 32px;
      height: 32px;
      border: 2px solid var(--dark-blue);
      background: white;
      color: var(--dark-blue);
      font-size: 18px;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      line-height: 1;
    }
    
    .qty-btn:hover:not(:disabled) {
      background: var(--primary-cyan);
      color: white;
      border-color: var(--primary-cyan);
      transform: scale(1.05);
    }
    
    .qty-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }
    
    .qty-display {
      width: 40px;
      text-align: center;
      font-size: 16px;
      font-weight: 700;
      color: var(--dark-blue);
      border: 2px solid #dee2e6;
      border-radius: 6px;
      padding: 5px 4px;
      background: white;
    }
    
    /* Make reservation button */
    .reserve-btn {
      margin-top: 20px;
      padding: 14px 35px;
      background: linear-gradient(135deg, var(--primary-cyan) 0%, #0096C7 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 800;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0,180,216,0.4);
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      align-self: flex-end;
    }
    
    .reserve-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(0,180,216,0.6);
    }
    
    .reserve-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      background: #6c757d;
    }
    
    .close-modal-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      background: #dc3545;
      color: white;
      border: none;
      width: 35px;
      height: 35px;
      border-radius: 50%;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      font-weight: bold;
      z-index: 10;
    }
    
    .close-modal-btn:hover {
      background: #c82333;
      transform: rotate(90deg);
    }
    
    /* Receipt modal */
    #receiptModal .modal-content {
      width: 500px;
      padding: 40px;
      text-align: center;
    }
    
    #receiptModal h3 {
      color: var(--dark-blue);
      margin-bottom: 30px;
      font-weight: 800;
      font-size: 26px;
    }
    
    #receiptModal p {
      margin: 15px 0;
      font-size: 16px;
      color: #555;
    }
    
    .receipt-details {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 12px;
      margin: 20px 0;
      border: 2px solid #e0e0e0;
    }
    
    .receipt-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #dee2e6;
    }
    
    .receipt-item:last-child {
      border-bottom: none;
      font-weight: 800;
      font-size: 18px;
      color: var(--primary-orange);
    }
    
    #buyerName {
      width: 100%;
      padding: 12px;
      border: 3px solid #dee2e6;
      border-radius: 10px;
      font-size: 15px;
      margin-top: 8px;
      transition: border 0.3s;
    }
    
    #buyerName:focus {
      outline: none;
      border-color: var(--primary-cyan);
      box-shadow: 0 0 0 3px rgba(0,180,216,0.1);
    }
    
    .pickup-warning {
      background: #FFF3CD;
      border: 2px solid #FFE69C;
      border-radius: 10px;
      padding: 15px;
      margin: 20px 0;
      color: #856404;
      font-weight: 600;
    }
    
    .confirm-btn {
      padding: 14px 40px;
      background: linear-gradient(135deg, var(--primary-cyan) 0%, #0096C7 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 800;
      cursor: pointer;
      margin-top: 20px;
      transition: all 0.3s;
      text-transform: uppercase;
    }
    
    .confirm-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(0,180,216,0.5);
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <div class="navbar">
    <a href="{% url 'map' %}" class="logo-container">
      <div class="logo-icon">
        <img src="{% static 'img/logo.png' %}" alt="Propane Point Logo" class="logo-img">
      </div>
      <div class="logo-text">
        <div class="logo-text-top">Propane</div>
        <div class="logo-text-bottom">POINT</div>
      </div>
    </a>
    <div class="nav-buttons">
      <!-- Show different buttons based on user role -->
      {% if request.user.profile.role == 'admin' %}
        <span class="role-badge role-admin">üëë ADMIN</span>
        <a href="{% url 'admin_dashboard' %}" class="nav-btn">Admin Dashboard</a>
      {% elif request.user.profile.role == 'seller' %}
        <span class="role-badge role-seller">üè™ SELLER</span>
        <a href="{% url 'my_stores' %}" class="nav-btn">My Stores</a>
      {% else %}
        <span class="role-badge role-customer">üõí CUSTOMER</span>
        <a href="{% url 'apply_seller' %}" class="nav-btn apply-seller">
          üè¢ Become a Seller
        </a>
      {% endif %}
      
      <a href="{% url 'my_orders' %}" class="nav-btn" title="My Reservations">
        My Reservations
      </a>
      <a href="{% url 'notifications' %}" class="nav-btn" title="Notifications">
        Notifications
        {% if unread_count > 0 %}
        <span class="notification-badge">{{ unread_count }}</span>
        {% endif %}
      </a>
      <a href="{% url 'logout' %}" class="nav-btn logout" title="Logout">
        Logout
      </a>
    </div>
  </div>

  <!-- Map -->
  <div id="map"></div>

<!-- Store Modal -->
  <div id="storeModal" class="modal">
    <div class="modal-content">
      <button class="close-modal-btn" onclick="closeStoreModal()">√ó</button>
      
      <!-- Unified Card Wrapper -->
      <div class="store-content-wrapper">
        <!-- Left Sidebar -->
        <div class="store-sidebar">
          <img id="storeOwnerPhoto" src="" class="owner-photo">
          <h4 id="storeName"></h4>
          <div class="store-owner-name" id="storeOwnerName"></div>
          <div class="description" id="storeDescription"></div>
        </div>
        
        <!-- Main Content -->
        <div class="store-main">
          <h3>üõí Select Propane Gas</h3>
          <div class="tank-grid" id="tankGrid"></div>
          <button class="reserve-btn" onclick="openReceipt()" id="reserveBtn" disabled>
            Make Reservation
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Receipt Modal -->
  <div id="receiptModal" class="modal">
    <div class="modal-content">
      <h3>üßæ Purchase Receipt</h3>
      <div class="receipt-details">
        <div class="receipt-item">
          <span>Store:</span>
          <strong id="receiptStore"></strong>
        </div>
        <div id="receiptItems"></div>
        <div class="receipt-item">
          <span>Total:</span>
          <strong>‚Ç±<span id="receiptTotal"></span></strong>
        </div>
      </div>
      <div class="pickup-warning">
        ‚è∞ <strong>Important:</strong> You must pick up within <strong>24 hours</strong> or your order will be cancelled and stock returned.
      </div>
      <p><strong>Buyer Name:</strong></p>
      <input type="text" id="buyerName" placeholder="Enter your full name">
      <button class="confirm-btn" onclick="confirmPurchase()">Confirm Purchase</button>
    </div>
  </div>

  <script>
  // Store data from Django
  var storesData = [
    {% for store in stores %}
    {
      id: {{ store.id }},
      name: "{{ store.name|escapejs }}",
      lat: {{ store.latitude }},
      lng: {{ store.longitude }},
      description: "{{ store.description|escapejs }}",
      owner: "{{ store.owner.username|escapejs }}",
      ownerPhoto: "{% if store.owner_photo %}{{ store.owner_photo.url }}{% else %}{% static 'img/default.png' %}{% endif %}",
      tanks: [
        {% for tank in store.tanks.all %}
        {% if tank.is_active %}
        {
          id: {{ tank.id }},
          type: "{{ tank.tank_type|escapejs }}",
          price: {{ tank.price }},
          stock: {{ tank.stock }},
          image:"{% static 'img/11kg.png' %}"
        }{% if not forloop.last %},{% endif %}
        {% endif %}
        {% endfor %}
      ]
    }{% if not forloop.last %},{% endif %}
    {% endfor %}
  ];

  // Initialize map
  var map = L.map('map', {
    center: [11.706149247057967, 124.42393797354536],
    zoom: 17,
    maxZoom: 19,
    maxBoundsViscosity: 1.0,
    worldCopyJump: false
  });

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19
  }).addTo(map);

  // Add markers for each store
  var currentStore = null;
  var selectedTanks = {};

  storesData.forEach(function(store) {
    var marker = L.marker([store.lat, store.lng]).addTo(map);
    marker.on("click", function() {
      openStoreModal(store);
    });
  });

  function openStoreModal(store) {
    currentStore = store;
    selectedTanks = {};
    
    // Update store info
    document.getElementById("storeName").textContent = store.name;
    document.getElementById("storeOwnerName").textContent = "Owner: " + store.owner;
    document.getElementById("storeDescription").textContent = store.description;
    document.getElementById("storeOwnerPhoto").src = store.ownerPhoto;
    
    // Clear and populate tanks
    var tankGrid = document.getElementById("tankGrid");
    tankGrid.innerHTML = "";
    
    if (store.tanks.length === 0) {
      tankGrid.innerHTML = '<p style="text-align:center; color:#666; grid-column: 1/-1;">No tanks available at this store.</p>';
    }
    
    store.tanks.forEach(function(tank) {
      var stockClass, stockText;
      var isOutOfStock = tank.stock === 0;
      
      if (isOutOfStock) {
        stockClass = 'stock-out';
        stockText = 'Out of Stock';
      } else if (tank.stock <= 5) {
        stockClass = 'stock-low';
        stockText = 'Low Stock';
      } else if (tank.stock <= 10) {
        stockClass = 'stock-medium';
        stockText = 'Medium Stock';
      } else {
        stockClass = 'stock-high';
        stockText = 'In Stock';
      }
      
      var div = document.createElement("div");
      div.className = "tank-card-new" + (isOutOfStock ? " out-of-stock" : "");
      div.dataset.tankId = tank.id;
      div.innerHTML = `
        <img src="${tank.image}" alt="${tank.type}" class="tank-image-new">
        <strong>${tank.type}</strong>
        <div class="tank-price-new">‚Ç±${tank.price}</div>
        <div class="tank-stock-info">
          <span class="stock-badge ${stockClass}">${stockText}</span>
          <div style="margin-top: 8px; font-size: 13px; color: #666;">${tank.stock} available</div>
        </div>
        ${!isOutOfStock ? `
          <div class="quantity-controls">
            <button class="qty-btn" onclick="decreaseQty(${tank.id}); event.stopPropagation();">‚àí</button>
            <div class="qty-display" id="qty-${tank.id}">0</div>
            <button class="qty-btn" onclick="increaseQty(${tank.id}, ${tank.stock}); event.stopPropagation();">+</button>
          </div>
        ` : ''}
      `;
      
      tankGrid.appendChild(div);
    });
    
    updateReserveButton();
    document.getElementById("storeModal").style.display = "flex";
  }

  function increaseQty(tankId, maxStock) {
    if (!selectedTanks[tankId]) {
      selectedTanks[tankId] = { qty: 0, tank: currentStore.tanks.find(t => t.id === tankId) };
    }
    
    if (selectedTanks[tankId].qty < maxStock) {
      selectedTanks[tankId].qty++;
      document.getElementById("qty-" + tankId).textContent = selectedTanks[tankId].qty;
      updateReserveButton();
    }
  }

  function decreaseQty(tankId) {
    if (selectedTanks[tankId] && selectedTanks[tankId].qty > 0) {
      selectedTanks[tankId].qty--;
      document.getElementById("qty-" + tankId).textContent = selectedTanks[tankId].qty;
      
      if (selectedTanks[tankId].qty === 0) {
        delete selectedTanks[tankId];
      }
      
      updateReserveButton();
    }
  }

  function updateReserveButton() {
    var hasSelection = Object.keys(selectedTanks).some(key => selectedTanks[key].qty > 0);
    document.getElementById("reserveBtn").disabled = !hasSelection;
  }

  function closeStoreModal() {
    document.getElementById("storeModal").style.display = "none";
  }

  function openReceipt() {
    var hasItems = Object.keys(selectedTanks).length > 0;
    if (!hasItems) {
      alert("‚ö†Ô∏è Please select at least one tank!");
      return;
    }
    
    // Calculate total and build receipt
    var total = 0;
    var itemsHTML = '';
    
    for (var tankId in selectedTanks) {
      var item = selectedTanks[tankId];
      var subtotal = item.tank.price * item.qty;
      total += subtotal;
      
      itemsHTML += `
        <div class="receipt-item">
          <span>${item.tank.type} (x${item.qty})</span>
          <strong>‚Ç±${subtotal}</strong>
        </div>
      `;
    }
    
    document.getElementById("receiptStore").textContent = currentStore.name;
    document.getElementById("receiptItems").innerHTML = itemsHTML;
    document.getElementById("receiptTotal").textContent = total;
    document.getElementById("buyerName").value = "";
    
    document.getElementById("storeModal").style.display = "none";
    document.getElementById("receiptModal").style.display = "flex";
  }

  function confirmPurchase() {
    var buyer = document.getElementById("buyerName").value.trim();
    if (!buyer) {
      alert("‚ö†Ô∏è Please enter your name!");
      return;
    }

    // Submit each tank reservation
    var form = document.createElement('form');
    form.method = 'POST';
    form.action = "{% url 'reserve_tank' 0 %}".replace('0', Object.keys(selectedTanks)[0]);
    
    var csrfToken = document.createElement('input');
    csrfToken.type = 'hidden';
    csrfToken.name = 'csrfmiddlewaretoken';
    csrfToken.value = '{{ csrf_token }}';
    
    var nameInput = document.createElement('input');
    nameInput.type = 'hidden';
    nameInput.name = 'name';
    nameInput.value = buyer;
    
    // Add quantity if needed (you may need to modify your backend)
    var qtyInput = document.createElement('input');
    qtyInput.type = 'hidden';
    qtyInput.name = 'quantity';
    qtyInput.value = selectedTanks[Object.keys(selectedTanks)[0]].qty;
    
    form.appendChild(csrfToken);
    form.appendChild(nameInput);
    form.appendChild(qtyInput);
    document.body.appendChild(form);
    form.submit();
  }

  // Close modals by clicking background
  document.querySelectorAll(".modal").forEach(m => {
    m.addEventListener("click", function(e) {
      if (e.target === m) m.style.display = "none";
    });
  });
  </script>
</body>
</html>
